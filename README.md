# FreeRTOS_Infantry_C_Board_Chassis_CPP
 Base on FreeRTOS
 For RMUC 2024 Wild Card Competition

 #### Encode
 本工程内文件使用GB2312编码格式兼容Keil中文显示

 #### 代码文件内特殊标注

- **@developing**为待开发

- **@warning**为警告

- **@note**为标注

#### 本项目基于FreeRTOS运行但仅使用**任务**来进行车辆逻辑的运行 *（任务函数皆在User/Task文件夹中）*，未使用如队列等其余的RTOS资源

#### NOTE
1. 推荐使用VSCode进行代码的开发和阅读，编译与调试则使用Keil进行
2. 推荐个人/团队使用GitHub对代码进行版本管理，可使用GitHub Desktop（一个桌面GUI）来降低GitHub的使用难度
3. 在编写程序的过程中应该要关注两个方面的优先级，一是硬件中断的优先级（**在STM32中硬件的优先级数字越低，则实际优先级越高**），二是RTOS任务的优先级（**在FreeRTOS中数字越大则优先级最高**）（**注：默认配置下，当硬件中断的优先级高于5时，中断则不接受RTOS的管理，因此无法在中断回调函数内调用FreeRTOS提供的函数**）
   > 讨论1：例如参考电机PID控制运行的情况。在通常条件下，控制器都需要一个稳定周期来运行，因此该工程的PID控制器的运算以及电机控制值全部运行在一个优先级为1（优先级仅低于0）的硬件定时器下来保证PID计算的实时性。且进行PID的运算则要求电机的数据为最新值来保证PID运算时的正确性以获得更优的控制响应性，因此与电机通信的CAN接收中断优先级为最高的0（**0为最高优先级**）来保证电机数据更新的实时性。

   > 讨论2：为了保证车辆的动态响应（如云台运动，底盘移动等），底盘的逻辑任务(*ChassisTask*函数)与进行板间通信的（*CommunicationTask*函数，遥控器的数据需要通过板间通信发送到底盘控制板）的FreeRTOS优先级为最高级
4. 需要养成边写代码边注释的习惯，在进行常量、变量和函数的命名时需要遵守一定的命名规范（本工程参考Google的C++项目命名规范），做到其他代码阅读者可以通过命名看出代码的大致含义

#### VSCode
- 推荐使用Keil Assistant插件（可自动生成*c_cpp_properties.json*文件以使用C++插件的Intellisense功能来进行代码补全、提示）

#### 文件夹说明
1. User文件夹为用户文件存放处，除STM32CubeMX生成的文件以外的文件皆放在此文件夹内
2. User文件夹内的Task文件夹存放所有的RTOS任务文件
3. UI文件夹内存放客户端UI绘制文件，分为动态及静态UI文件（此处的动态静态指的是UI在客户端中是否是可刷新的）

#### 文件说明
1. call_back.cpp内含有串口空闲接收中断，CAN接收中断以及PID运算的定时器中断（*MainCallback*函数在*main.c*中被调用）
2. 全车PID运算在*call_back.cpp*文件内的*MainCallBack*函数中由TIM7以1KHz的频率定频运行（且TIM7的中断优先级为最高级的0）
3. config.hpp文件内可修改该工程的最大电机数量
4. 所有的对象都在variables.cpp文件内创建

每个文件的文件头注释为比完赛后加